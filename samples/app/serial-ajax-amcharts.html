<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <title></title>
    <style type="text/css">
        html, body {
            height: 100%;
        }

        #chartdiv {
            height: 80%;
        }
    </style>
</head>
<body>
<div id="chartdiv"></div>
<script src="/jqChartJQueryPlugin_3_8_7_0/js/jquery-1.11.1.min.js"></script>
<script src="js/amcharts.js" type="text/javascript"></script>
<script src="js/serial.js" type="text/javascript"></script>
<script>
    var isJointDebug=false;

    const numberShowed = 6;
    var numberDate = 6;
    var chartData = [];

    var today = new Date();
    function generateChartData(numberDate) {
        var arr = []

        var today = new Date();
        var firstDay = today.getDate() - numberDate;
        today.setDate(firstDay ? firstDay : 1);

        for (var i = 0; i <= numberShowed; i++) {
            // we create date objects here. In your data, you can have date strings
            // and then set format of your dates using chart.dataDateFormat property,
            // however when possible, use date objects, as this will speed up chart rendering.
            var newDate = new Date(today);
            newDate.setDate(newDate.getDate() + i);

            var val = Math.round(Math.random() * 40) - 20;

            arr.push({
                date: newDate,
                val: val
            });
        }
        return arr
    }

    AmCharts.ready(function () {

        $.getJSON('line-data.json', function (data) {
            if (isJointDebug) {
                chartData = data;
            } else {
                chartData = generateChartData(numberDate);
            }

            // chart code will go here
            var chart = new AmCharts.AmSerialChart();
            chart.dataProvider = chartData;
            chart.categoryField = "date";
//        chart.angle = 30;
//        chart.depth3D = 15;

            var graph = new AmCharts.AmGraph();
            graph.valueField = "val";
//        graph.type = "column";
            graph.type = "line";
//        graph.fillAlphas = 0.8;
//        graph.fillAlphas = 0.5;
            graph.balloonText = "[[category]]: <b>[[value]]</b>";
            graph.fillAlphas = 0; // or delete this line, as 0 is default
            graph.bullet = "round";
            graph.lineColor = "#8d1cc6";
            chart.addGraph(graph);

            var categoryAxis = chart.categoryAxis;
            categoryAxis.autoGridCount = false;
            categoryAxis.gridCount = chartData.length;
            categoryAxis.gridPosition = "start";
            categoryAxis.labelRotation = 90;

            categoryAxis.parseDates = true;
            categoryAxis.gridAlpha = 0.15;
            categoryAxis.minorGridEnabled = true;
            categoryAxis.axisColor = "#DADADA";

            var chartCursor = new AmCharts.ChartCursor();
            chartCursor.fullWidth = true;
            chartCursor.cursorAlpha = 0.1;
            chartCursor.pan = true;
//        chartCursor.selectWithoutZooming=true;
            chartCursor.addListener('zoomed', handleZoom)

            function handleZoom(event) {
                var target = event.target;
                if (isNaN(target.previousIndex)) {
                    return;
                }
                if (target.index - target.previousIndex < 0) {
                    var date = chart.dataProvider[numberShowed].date;
                    if(!(chart.dataProvider[numberShowed].date instanceof Date)){
                        return;
                    }
                    if (today.getTime() <= date.getTime()) {
//                    console.log('last showed')
                    } else {
                        chartData = generateChartData(--numberDate);
                        chart.dataProvider = chartData
                        chart.validateData();
                    }
                } else {
//                console.log('right pan')
                    chartData = generateChartData(++numberDate);
                    chart.dataProvider = chartData
                    chart.validateData();
                }
            }

            chart.addChartCursor(chartCursor);


            chart.addListener("dataUpdated", function func() {
                zoomChart(chartData)
            });
            function zoomChart(chartData) {
                // different zoom methods can be used - zoomToIndexes, zoomToDates, zoomToCategoryValues
//            chart.zoomToIndexes(0, numberDate-1);
            }

            chart.write('chartdiv');
        })
    });

</script>
</body>
</html>