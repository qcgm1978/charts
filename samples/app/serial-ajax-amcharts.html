<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <title></title>
    <style type="text/css">
        html, body {
            height: 100%;
        }

        #chartdiv {
            height: 80%;
        }
    </style>
</head>
<body>
<div id="chartdiv"></div>
<script src="/jqChartJQueryPlugin_3_8_7_0/js/jquery-1.11.1.min.js"></script>
<script src="js/amcharts.js" type="text/javascript"></script>
<script src="js/serial.js" type="text/javascript"></script>
<script>
    var isJointDebug = false;
    function generateChartData(numberDate, axisVal) {
        var arr = []

        var today = new Date();
        var firstDay = today.getDate() - numberDate;
        today.setDate(firstDay ? firstDay : 1);

        for (var i = 0; i <= numberShowed; i++) {
            // we create date objects here. In your data, you can have date strings
            // and then set format of your dates using chart.dataDateFormat property,
            // however when possible, use date objects, as this will speed up chart rendering.
            var newDate = new Date(today);
            newDate.setDate(newDate.getDate() + i);

            var items = {
                date: newDate
            };
            $.each(axisVal, function (i, n) {
                items[n.val] = Math.round(Math.random() * 40) - 20;
            });
            arr.push(items);
        }
        return arr
    }
    function getChartData(data) {
        if (isJointDebug) {
            chartData = data;
        } else {
            chartData = generateChartData(numberDate, axisVal);
        }
    }
    function displayNewChartDataAsPan(num) {
        if (isJointDebug) {
            $.getJSON(url, function (data) {
                chart.dataProvider = data;
                chart.validateData();
            });
        } else {
            chartData = generateChartData(numberDate, axisVal);
            chart.dataProvider = chartData
            chart.validateData();
        }
    }

    const url = 'line-data.json';
    const numberShowed = 6;
    const axisVal = [
        {
            val: 'val1',
            color: "#8d1cc6"
        },
        {
            val: 'val2',
            color: "#FF6600"
        },
        {
            val:"val3",
            color:"#FCD202"
        },
        {
            val:"val4",
            color:"#B0DE09"
        }
    ];
    var numberDate = 6;
    var chartData = [];
    var chart = null;

    var today = new Date();

    AmCharts.ready(function () {

        $.getJSON(url, function (data) {
            getChartData(data);

            // chart code will go here
            chart = new AmCharts.AmSerialChart();
            chart.dataProvider = chartData;
            chart.categoryField = "date";
//        chart.angle = 30;
//        chart.depth3D = 15;

            function addGraph(valueField, lineColor) {
                var graph = new AmCharts.AmGraph();
                graph.valueField = valueField;
                graph.type = "line";
                graph.balloonText = "[[category]]: <b>[[value]]</b>";
                graph.fillAlphas = 0; // or delete this line, as 0 is default
                graph.bullet = "round";
                graph.lineColor = lineColor;
                chart.addGraph(graph);
            }

            $.each(axisVal, function (i, n) {
                addGraph(n.val, n.color);

            });
            var categoryAxis = chart.categoryAxis;
            categoryAxis.autoGridCount = false;
            categoryAxis.gridCount = chartData.length;
            categoryAxis.gridPosition = "start";
            categoryAxis.labelRotation = 90;

            categoryAxis.parseDates = true;
            categoryAxis.gridAlpha = 0.15;
            categoryAxis.minorGridEnabled = true;
            categoryAxis.axisColor = "#DADADA";

            var chartCursor = new AmCharts.ChartCursor();
            chartCursor.fullWidth = true;
            chartCursor.cursorAlpha = 0.1;
            chartCursor.pan = true;
//        chartCursor.selectWithoutZooming=true;
            chartCursor.addListener('zoomed', handleZoom)

            function handleZoom(event) {
                var target = event.target;
                if (isNaN(target.previousIndex)) {
                    return;
                }
                if (target.index - target.previousIndex < 0) {
                    var date = chart.dataProvider[numberShowed].date;
                    if (!(chart.dataProvider[numberShowed].date instanceof Date)) {
                        return;
                    }
                    if (today.getTime() <= date.getTime()) {
//                    console.log('last showed')
                    } else {
                        displayNewChartDataAsPan(--numberDate);
                    }
                } else {
//                console.log('right pan')
                    displayNewChartDataAsPan(++numberDate);

                }
            }

            chart.addChartCursor(chartCursor);

            chart.write('chartdiv');
        })
    });

</script>
</body>
</html>